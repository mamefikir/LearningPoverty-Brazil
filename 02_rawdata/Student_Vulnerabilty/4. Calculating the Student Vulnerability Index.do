*** ============================================================================
***
***                   Vulnerability to COVID 19
***
*** ============================================================================

clear 
         use "C:\Users\wb499746\OneDrive - WBG\Desktop\Education COVID 19\COVID 19 Response report\SAEB 2017 - Learning and Family Components.dta"
merge 1:1 id_municipio using "C:\Users\wb499746\OneDrive - WBG\Desktop\Education COVID 19\COVID 19 Response report\SAEB 2017 - Teacher.dta"
drop if _merge ==2
drop _merge
merge 1:1 id_municipio using "C:\Users\wb499746\OneDrive - WBG\Desktop\Education COVID 19\COVID 19 Response report\SAEB 2017 - School Meals.dta"
drop if _merge ==2
drop _merge

gen VI = Family_Vulnerability + Learning + Teacher_Component + School_Meals

egen Max = max(VI)
egen Min = min(VI)

    gen Vulnarability_Index = (VI - Min)/(Max - Min)
   drop Max Min VI
drop if Vulnarability_Index ==.

*** ============================================================================

order id_uf id_municipio Learning Family_Vulnerability Teacher_Component School_Meals Vulnarability_Index
sort Vulnarability_Index
tostring id_municipio, replace
gen City = substr(id_municipio,1,6)
destring id_municipio City, replace

save "C:\Users\wb499746\OneDrive - WBG\Desktop\Education COVID 19\COVID 19 Response report\SAEB 2017 - Vulnerability Index.dta", replace

*** ============================================================================

gen State = id_uf

    gen Estados = ""
replace Estados = "Rondônia" if State == 11
replace Estados = "Acre" if State == 12
replace Estados = "Amazonas" if State == 13
replace Estados = "Roraima" if State == 14
replace Estados = "Pará" if State == 15
replace Estados = "Amapá" if State == 16
replace Estados = "Tocantins" if State == 17
replace Estados = "Maranhão" if State == 21
replace Estados = "Piauí" if State == 22
replace Estados = "Ceará" if State == 23
replace Estados = "Rio Grande do Norte" if State == 24
replace Estados = "Paraíba" if State == 25
replace Estados = "Pernambuco" if State == 26
replace Estados = "Alagoas" if State == 27
replace Estados = "Sergipe" if State == 28
replace Estados = "Bahia" if State == 29
replace Estados = "Minas Gerais" if State == 31
replace Estados = "Espírito Santo" if State == 32
replace Estados = "Rio de Janeiro" if State == 33
replace Estados = "São Paulo" if State == 35
replace Estados = "Paraná" if State == 41
replace Estados = "Santa Catarina" if State == 42
replace Estados = "Rio Grande do Sul" if State == 43 
replace Estados = "Mato Grosso do Sul" if State == 50
replace Estados = "Mato Grosso" if State == 51
replace Estados = "Goiás" if State == 52
replace Estados = "Distrito Federal" if State == 53
label var Estados "State Names"

graph hbar Vulnarability_Index, over(Estados, sort(Vulnarability_Index) gap(*.2) label(ang(0) labsize(vsmall))) bar(1, fcolor(ebblue)) intensity(*.8) blabel(bar, position(outside) format(%12.2f) color(black) size(small)) nofill graphregion(color(white)) title("{bf:Student Vulnerability Per State, SAEB 2017}" "{it: North and Northeast populate the highest Vulnerabiilty}",  span pos(11) color(black) size(medium)) plotregion(color(white)) ytitle("Student Vulnerability Score" "0 = Less Vulnerable; 1 = Critically Vulnerable") yline(.495, lwidth(medium) lcolor(black)) exclude0 ylab(.30(.05).70) leg(ring(0) col(1))

*** ============================================================================
***
***                               MAPS PER CITY, 2017
***
*** ============================================================================

clear
use "C:\Users\wb499746\OneDrive - WBG\Report - Human Development Project\8. Maps\brasil.dta"
duplicates drop City, force

***  Merging 

merge 1:1 City using "C:\Users\wb499746\OneDrive - WBG\Desktop\Education COVID 19\COVID 19 Response report\SAEB 2017 - Vulnerability Index.dta"
drop if _merge ==1
drop _merge

*** ============================================================================

   sort Vulnarability_Index
group1d Vulnarability_Index, max(4)
   3    1540 3951  .557898    5490        1     0.63    0.06
   2    2657 1294  .420308    3950  .557737     0.49    0.04
   1    1293    1        0    1293  .420177     0.35    0.06

*** ============================================================================
*** Maps for all Brazil

spmap Vulnarability_Index using "C:\Users\wb499746\OneDrive - WBG\Report - Human Development Project\8. Maps\coord_brasil.dta", id(id) ocolor(white white white white) osize(vvthin vvthin vvthin vvthin) clmethod(custom) fcolor(ebblue*.9 ebblue*.5 cranberry*.5 cranberry*.9) clbreaks(0 .35 .49 .63 1) legend(symy(*2) symx(*2) size(*.5) rowgap(*.2) position(4) region(fcolor(gs16) lwidth(thin))) legorder(lohi) legend(label(2 "Less Vulnerable") label(3 "Vulnerable") label(4 "Highly Vulnerable") label(5 "Critically Vulnerable") size(vsmall)) graphregion(color(white)) title("{bf:Student Vulnerability to School Closures, 5th Grade}" "{it:Index: School Meals, Tearcher Preparedness, Learning and Family. SAEB 2017}", span pos(11) color(black) size(vsmall)) plotregion(color(white))

